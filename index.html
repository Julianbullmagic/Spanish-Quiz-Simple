<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Vocabulary Quiz</title>
    <style>
        :root {
            --primary: #6200ee;
            --primary-dark: #3700b3;
            --surface: #ffffff;
            --background: #f5f5f5;
            --error: #b00020;
            --success: #00c853;
            --text-primary: #000000;
            --text-secondary: #666666;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        h1 {
            margin-top: 0;
            color: var(--primary);
        }

        .input-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus {
            border-color: var(--primary);
        }

        /* Buttons */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            margin-bottom: 1rem;
            touch-action: manipulation; /* Improves touch response */
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            margin-top: 1rem;
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        .btn-outline:hover {
            background-color: #f3e5f5;
        }

        .hidden {
            display: none;
        }

        /* Quiz Specific Styles */
        .lang-indicator {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .word-display {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .feedback-stats {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            min-height: 1.2em;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .input-correct {
            border-color: var(--success) !important;
            background-color: #e8f5e9;
            color: #00600f;
        }

        .input-incorrect {
            border-color: var(--error) !important;
            background-color: #ffebee;
            color: var(--error);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: #eee;
            margin-top: 2rem;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .setup-screen {
            animation: fadeIn 0.5s;
        }

        .quiz-screen {
            animation: slideIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Accent Buttons */
        .accent-row {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .accent-btn {
            background: #e0e0e0;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.1rem;
            color: #333;
            transition: background 0.2s;
            font-family: inherit;
        }
        
        .accent-btn:hover {
            background: #d0d0d0;
        }
        
        .accent-btn:active {
            transform: scale(0.95);
        }

        .mode-controls {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .flush-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, background-color 0.2s;
        }

        .flush-btn:hover {
            transform: scale(1.1);
            background-color: #d32f2f;
        }

        .flush-btn:active {
            transform: scale(0.9);
        }
    </style>
</head>
<body>
    <button class="flush-btn" onclick="flushState()" title="Flush Game State">üóëÔ∏è</button>

    <!-- Setup Screen -->
    <div id="setupScreen" class="container setup-screen">
        <h1>Spanish Trainer</h1>
        <p>Master the 1000 most common words.</p>
        
        <div class="input-group">
            <label for="progressInput">How many words have you learned?</label>
            <input type="number" id="progressInput" min="0" max="1000" placeholder="e.g., 50">
        </div>

        <button class="btn" onclick="startQuiz()">Start Quiz</button>
        <button class="btn btn-outline" onclick="resetProgress()">Reset Progress</button>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="container quiz-screen hidden">
        <div class="lang-indicator" id="langIndicator"></div>
        <div class="word-display" id="questionWord">Hola</div>
        
        <div class="input-group">
            <input type="text" id="answerInput" placeholder="Type translation..." autocomplete="off">
            <div class="accent-row">
                <button class="accent-btn" onclick="insertChar('√°')">√°</button>
                <button class="accent-btn" onclick="insertChar('√©')">√©</button>
                <button class="accent-btn" onclick="insertChar('√≠')">√≠</button>
                <button class="accent-btn" onclick="insertChar('√≥')">√≥</button>
                <button class="accent-btn" onclick="insertChar('√∫')">√∫</button>
                <button class="accent-btn" onclick="insertChar('√º')">√º</button>
                <button class="accent-btn" onclick="insertChar('√±')">√±</button>
                <button class="accent-btn" onclick="insertChar('¬ø')">¬ø</button>
                <button class="accent-btn" onclick="insertChar('¬°')">¬°</button>
            </div>
        </div>
        
        <button class="btn" onclick="checkAnswer()">Submit</button>
        <button id="overrideBtn" class="btn hidden" style="background-color: #fbc02d; color: black; margin-top: 0.5rem;" onclick="overrideCorrect()">‚ö†Ô∏è I was right (Override)</button>

        <div class="feedback-stats" id="statsDisplay"></div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <button class="btn btn-outline" onclick="copyAiPrompt()">
            üìã Copy AI Practice Prompt
        </button>

                <div class="mode-controls">

                    <button class="btn btn-outline" style="margin:0; font-size: 0.8rem;" onclick="prevCard()" id="backBtn">‚¨ÖÔ∏è Back</button>

                    <button class="btn btn-outline" style="margin:0; font-size: 0.8rem;" onclick="startQuiz('random')">üîÄ Switch to Random Shuffle Mode</button>

                    <button class="btn btn-outline" style="margin:0; font-size: 0.8rem;" onclick="startQuiz('regular')">Qw Switch to Regular Learning Mode</button>

                </div>

            </div>

        

            <script>

                // Placeholder list - REPLACE THIS with your full 1000 word list

                const rawWordList = [

                    { "Hola": "Hello" },

        
            { "Buenos d√≠as": "Good morning" },
            { "Buenas tardes": "Good afternoon" },
            { "Buenas noches": "Good evening/Good night" },
            { "¬øC√≥mo est√°s?": "How are you?" },
            { "Bien": "Good/Well" },
            { "Muy bien": "Very good/Very well" },
            { "¬øY t√∫?": "And you?" },
            { "Adi√≥s": "Goodbye" },
            { "Hasta luego": "See you later" },
            { "Gracias": "Thank you" },
            { "Muchas gracias": "Thank you very much" },
            { "De nada": "You're welcome" },
            { "Por favor": "Please" },
            { "Lo siento": "I'm sorry" },
            { "Perd√≥n": "Excuse me/Sorry" },
            { "Disculpe": "Excuse me (formal)" },
            { "Con permiso": "Excuse me (passing through)" },
            { "Mucho gusto": "Nice to meet you" },
            { "Encantado": "Delighted (masculine)" },
            { "Encantada": "Delighted (feminine)/Enchanted" },
            { "Me llamo": "My name is/I call myself" },
            { "¬øC√≥mo te llamas?": "What's your name?" },
    
            // People & Family
            { "La familia": "Family" },
            { "los padres": "parents" },
            { "la madre": "mother" },
            { "el padre": "father" },
            { "el hermano": "brother" },
            { "la hermana": "sister" },
            { "el abuelo": "grandfather" },
            { "la abuela": "grandmother" },
            { "el t√≠o": "uncle" },
            { "la t√≠a": "aunt" },
            { "el primo": "cousin (masculine)" },
            { "la prima": "cousin (feminine)" },
            { "la sobrina": "niece" },
            { "el sobrino": "nephew" },
            { "el nieto": "grandson" },
            { "la nieta": "granddaughter" },
            { "el esposo": "husband" },
            { "la esposa": "wife" },
            { "el hijo": "son" },
            { "la hija": "daughter" },
            { "el bisabuelo": "great-grandfather" },
            { "la bisabuela": "great-grandmother" },
            { "el bisnieto": "great-grandson" },
            { "la bisnieta": "great-granddaughter" },
            { "los parientes": "relatives" },
            
            // Food & Drink - Fruits
            { "La manzana": "apple" },
            { "la pera": "pear" },
            { "el pl√°tano": "banana" },
            { "el mel√≥n": "melon" },
            { "la sand√≠a": "watermelon" },
            { "la uva": "grape" },
            { "el durazno": "peach" },
            { "el melocot√≥n": "peach" },
            { "el albaricoque": "apricot" },
            { "el mango": "mango" },
            { "la pi√±a": "pineapple" },
            { "la fresa": "strawberry" },
            { "la cereza": "cherry" },
            { "la naranja": "orange" },
            { "la clementina": "clementine" },
            { "el higo": "fig" },
            { "la mora": "blackberry" },
            { "el ar√°ndano": "blueberry/cranberry" },
            { "la frambuesa": "raspberry" },
            { "la ciruela": "plum" },
            { "la granada": "pomegranate" },
            { "la lima": "lime" },
            { "el lim√≥n": "lemon" },
            
            // Vegetables
            { "La lechuga": "lettuce" },
            { "el tomate": "tomato" },
            { "la papa": "potato" },
            { "la patata": "potato" },
            { "la batata": "sweet potato" },
            { "la coliflor": "cauliflower" },
            { "el repollo": "cabbage" },
            { "el br√≥coli": "broccoli" },
            { "la zanahoria": "carrot" },
            { "la berenjena": "eggplant" },
            { "la calabaza": "pumpkin" },
            { "el calabac√≠n": "zucchini" },
            { "el pepino": "cucumber" },
            { "la okra": "okra" },
            { "el ajo": "garlic" },
            { "la cebolla": "onion" },
            { "el pimiento": "bell pepper" },
            { "el champi√±√≥n": "mushroom" },
            { "la seta": "mushroom" },
            { "la espinaca": "spinach" },
            { "las jud√≠as verdes": "green beans" },
            { "los frijoles": "beans" },
            { "los guisantes": "peas" },
            { "los esp√°rragos": "asparagus" },
            
            // Other Foods
            { "El pan": "bread" },
            { "el arroz": "rice" },
            { "el huevo": "egg" },
            { "la carne": "meat" },
            { "el cerdo": "pork" },
            { "el pollo": "chicken" },
            { "la res": "beef" },
            { "la vaca": "beef/cow" },
            { "el pescado": "fish" },
            { "la pasta": "pasta" },
            { "la miel": "honey" },
            { "el az√∫car": "sugar" },
            
            // Drinks
            { "El agua": "water" },
            { "el caf√©": "coffee" },
            { "el t√©": "tea" },
            { "la cerveza": "beer" },
            { "la leche": "milk" },
            
            // Dining
            { "El desayuno": "breakfast" },
            { "el almuerzo": "lunch" },
            { "la cena": "dinner" },
            { "el horno": "oven" },
            { "la estufa": "stove" },
            { "el microondas": "microwave" },
            { "la basura": "trash" },
            { "la sart√©n": "pan" },
            { "el plato": "plate" },
            { "el tenedor": "fork" },
            { "el cuchillo": "knife" },
            { "la cuchara": "spoon" },
            { "el vaso": "glass" },
            { "la taza": "cup" },
            { "la sal": "salt" },
            
            // Tastes (Adjectives - usually kept as is, but can be used as nouns in context. Keeping as adjectives here or generic)
            { "dulce": "sweet" },
            { "picante": "spicy" },
            { "agrio": "sour" },
            { "amargo": "bitter" },
            
            // Home & Objects - Rooms
            { "La casa": "house" },
            { "la cocina": "kitchen" },
            { "el sal√≥n": "living room" },
            { "el comedor": "dining room" },
            { "el dormitorio": "bedroom" },
            { "la habitaci√≥n": "room" },
            { "el cuarto": "room" },
            { "el ba√±o": "bathroom" },
            { "el s√≥tano": "basement" },
            
            // Furniture & Fixtures
            { "Las escaleras": "stairs" },
            { "la puerta": "door" },
            { "la ventana": "window" },
            { "el techo": "ceiling" },
            { "la l√°mpara": "lamp" },
            { "el reloj": "clock/watch" },
            { "la televisi√≥n": "television" },
            { "la cama": "bed" },
            { "el armario": "wardrobe/closet" },
            { "el refrigerador": "refrigerator" },
            { "el frigor√≠fico": "refrigerator" },
            { "el fregadero": "kitchen sink" },
            { "el lavamanos": "bathroom sink" },
            { "el espejo": "mirror" },
            { "la ducha": "shower" },
            { "el inodoro": "toilet" },
            { "la ba√±era": "bathtub" },
            
            // Bathroom Items
            { "El cepillo": "brush" },
            { "el cepillo de dientes": "toothbrush" },
            { "el secador": "hair dryer" },
            { "el jab√≥n": "soap" },
            { "el champ√∫": "shampoo" },
            { "el acondicionador": "conditioner" },
            { "la crema dental": "toothpaste" },
            { "la esponja": "sponge" },
            { "el papel higi√©nico": "toilet paper" },
            { "la toalla": "towel" },
            
            // Cleaning Verbs
            { "Limpiar": "to clean" },
            { "lavar": "to wash" },
            { "barrer": "to sweep" },
            
            // Places & Directions
            { "El lugar": "place" },
            { "la tienda": "store" },
            { "la escuela": "school" },
            { "la biblioteca": "library" },
            { "el supermercado": "supermarket" },
            { "el edificio": "building" },
            { "la oficina": "office" },
            { "la estaci√≥n de tren": "train station" },
            { "la estaci√≥n de autob√∫s": "bus station" },
            { "la playa": "beach" },
            { "el restaurante": "restaurant" },
            { "el parque": "park" },
            { "la iglesia": "church" },
            { "el cine": "cinema/movie theater" },
            { "el correo": "post office" },
            { "la calle": "street" },
            { "la esquina": "corner" },
            { "el centro comercial": "shopping mall" },
            { "el estadio": "stadium" },
            { "el gimnasio": "gym" },
            { "la piscina": "pool" },
            
            // Prepositions
            { "Al lado de": "next to/beside" },
            { "detr√°s de": "behind" },
            { "a la izquierda de": "to the left of" },
            { "a la derecha de": "to the right of" },
            { "entre": "between" },
            { "enfrente": "in front of/opposite" },
            { "delante de": "in front of" },
            
            // Directions
            { "Girar": "to turn" },
            { "cruzar": "to cross" },
            { "seguir derecho": "to go straight" },
            { "primero": "first" },
            { "luego": "then/later" },
            
            // Clothing
            { "El vestido": "dress" },
            { "la camisa": "shirt" },
            { "la camiseta": "t-shirt" },
            { "los pantalones": "pants" },
            { "los pantalones cortos": "shorts" },
            { "la ropa interior": "underwear" },
            { "la blusa": "blouse" },
            { "la falda": "skirt" },
            { "el traje": "suit" },
            { "el traje de ba√±o": "swimsuit" },
            { "el calcet√≠n": "sock" },
            { "el su√©ter": "sweater" },
            { "la corbata": "tie" },
            { "los zapatos": "shoes" },
            { "las botas": "boots" },
            { "las zapatillas": "sneakers" },
            { "el sombrero": "hat" },
            { "el bolso": "purse/handbag" },
            { "el cintur√≥n": "belt" },
            { "el abrigo": "coat" },
            { "el pijama": "pajamas" },
            
            // Weather Expressions (Verbs/Adjectives mainly, but Nouns included)
            { "Hace calor": "It's hot" },
            { "Hace fr√≠o": "It's cold" },
            { "Hace buen tiempo": "The weather is good" },
            { "Hace mal tiempo": "The weather is bad" },
            { "Hace sol": "It's sunny" },
            { "nublado": "cloudy" },
            { "soleado": "sunny" },
            { "hay viento": "it's windy" },
            { "la nieve": "snow" },
            { "la lluvia": "rain" },
            { "la tormenta": "storm" },
            { "la nube": "cloud" },
            { "el trueno": "thunder" },
            { "el rel√°mpago": "lightning" },
            { "Est√° nevando": "It's snowing" },
            { "Est√° lluvioso": "It's rainy" },
            { "Est√° tormentoso": "It's stormy" },
            
            // Seasons
            { "La primavera": "spring" },
            { "el verano": "summer" },
            { "el oto√±o": "autumn/fall" },
            { "el invierno": "winter" },
            
            // Celestial
            { "El sol": "sun" },
            { "la luna": "moon" },
            
            // Animals
            { "El gato": "cat" },
            { "el perro": "dog" },
            { "el p√°jaro": "bird" },
            { "el elefante": "elephant" },
            { "el le√≥n": "lion" },
            { "el oso": "bear" },
            { "el caballo": "horse" },
            { "el tigre": "tiger" },
            { "el toro": "bull" },
            { "la tortuga": "turtle" },
            { "el cerdo": "pig" },
            { "la vaca": "cow" },
            { "la oveja": "sheep" },
            { "el pato": "duck" },
            
            // Body Parts
            { "La cabeza": "head" },
            { "la cara": "face" },
            { "los ojos": "eyes" },
            { "las orejas": "ears" },
            { "el pecho": "chest" },
            { "los brazos": "arms" },
            { "las piernas": "legs" },
            { "los pies": "feet" },
            { "las manos": "hands" },
            { "los dedos": "fingers" },
            { "los dedos de pies": "toes" },
            { "la espalda": "back" },
            { "la rodilla": "knee" },
            { "el codo": "elbow" },
            { "el hombro": "shoulder" },
            { "el tobillo": "ankle" },
            { "los dientes": "teeth" },
            { "el est√≥mago": "stomach" },
            { "la cadera": "hip" },
            { "el pelo": "hair" },
            { "el cabello": "hair" },
            { "la mu√±eca": "wrist" },
            
            // Physical Descriptions
            { "Alto": "tall (male)" },
            { "alta": "tall (female)" },
            { "bajo": "short (male)" },
            { "baja": "short (female)" },
            { "delgado": "thin/slim (male)" },
            { "delgada": "thin/slim (female)" },
            { "gordo": "fat (male)" },
            { "gorda": "fat (female)" },
            { "guapo": "handsome/good-looking (male)" },
            { "guapa": "beautiful/good-looking (female)" },
            { "hermoso": "beautiful/handsome (male)" },
            { "hermosa": "beautiful (female)" },
            { "feo": "ugly (male)" },
            { "fea": "ugly (female)" },
            { "fuerte": "strong" },
            { "musculoso": "muscular (male)" },
            { "musculosa": "muscular (female)" },
            { "moreno": "dark-haired/dark-skinned (male)" },
            { "morena": "dark-haired/dark-skinned (female)" },
            { "rubio": "blonde (male)" },
            { "rubia": "blonde (female)" },
            { "pelirrojo": "red-haired (male)" },
            { "pelirroja": "red-haired (female)" },
            { "canoso": "gray-haired" },
            { "joven": "young" },
            { "viejo": "old (male)" },
            { "vieja": "old (female)" },
            { "mayor": "older" },
            { "p√°lido": "pale (male)" },
            { "p√°lida": "pale (female)" },
            
            // Personality
            { "Amable": "kind" },
            { "valiente": "brave" },
            { "sensible": "sensitive" },
            { "horrible": "horrible" },
            { "ambicioso": "ambitious (male)" },
            { "ambiciosa": "ambitious (female)" },
            { "apasionado": "passionate (male)" },
            { "apasionada": "passionate (female)" },
            { "cuidadoso": "careful (male)" },
            { "cuidadosa": "careful (female)" },
            { "c√≠nico": "cynical (male)" },
            { "c√≠nica": "cynical (female)" },
            { "dependiente": "dependent" },
            { "independiente": "independent" },
            { "divertido": "fun (male)" },
            { "divertida": "fun (female)" },
            { "gracioso": "funny (male)" },
            { "graciosa": "funny (female)" },
            { "dulce": "sweet" },
            { "educado": "polite (male)" },
            { "educada": "polite (female)" },
            { "inteligente": "intelligent" },
            { "generoso": "generous (male)" },
            { "generosa": "generous (female)" },
            { "paciente": "patient" },
            { "impaciente": "impatient" },
            { "impulsivo": "impulsive (male)" },
            { "impulsiva": "impulsive (female)" },
            { "interesante": "interesting" },
            { "malo": "bad (male)" },
            { "mala": "bad (female)" },
            { "mentiroso": "liar (male)" },
            { "mentirosa": "liar (female)" },
            { "perezoso": "lazy (male)" },
            { "perezosa": "lazy (female)" },
            { "poderoso": "powerful (male)" },
            { "poderosa": "powerful (female)" },
            { "positivo": "positive (male)" },
            { "positiva": "positive (female)" },
            { "reservado": "reserved (male)" },
            { "reservada": "reserved (female)" },
            { "serio": "serious (male)" },
            { "seria": "serious (female)" },
            { "simp√°tico": "nice/pleasant (male)" },
            { "simp√°tica": "nice/pleasant (female)" },
            { "talentoso": "talented (male)" },
            { "talentosa": "talented (female)" },
            
            // Emotions
            { "Feliz": "happy" },
            { "triste": "sad" },
            { "emocionado": "excited (male)" },
            { "emocionada": "excited (female)" },
            { "cansado": "tired (male)" },
            { "cansada": "tired (female)" },
            { "enfadado": "angry (male)" },
            { "enfadada": "angry (female)" },
            { "enojado": "angry (male)" },
            { "enojada": "angry (female)" },
            { "preocupado": "worried (male)" },
            { "preocupada": "worried (female)" },
            { "aburrido": "bored (male)" },
            { "aburrida": "bored (female)" },
            { "confundido": "confused (male)" },
            { "confundida": "confused (female)" },
            { "enamorado": "in love (male)" },
            { "enamorada": "in love (female)" },
            { "asustado": "scared (male)" },
            { "asustada": "scared (female)" },
            { "frustrado": "frustrated (male)" },
            { "frustrada": "frustrated (female)" },
            { "sorprendido": "surprised (male)" },
            { "sorprendida": "surprised (female)" },
            { "c√≥modo": "comfortable (male)" },
            { "c√≥moda": "comfortable (female)" },
            { "inc√≥modo": "uncomfortable (male)" },
            { "inc√≥moda": "uncomfortable (female)" },
            { "avergonzado": "embarrassed (male)" },
            { "avergonzada": "embarrassed (female)" },
            { "t√≠mido": "shy (male)" },
            { "t√≠mida": "shy (female)" },
            { "nervioso": "nervous (male)" },
            { "nerviosa": "nervous (female)" },
            { "ansioso": "anxious (male)" },
            { "ansiosa": "anxious (female)" },
            
            // Sports
            { "El b√©isbol": "baseball" },
            { "el f√∫tbol": "soccer/football" },
            { "el baloncesto": "basketball" },
            { "el b√°squetbol": "basketball" },
            { "el golf": "golf" },
            { "el hockey": "hockey" },
            { "el tenis": "tennis" },
            { "el voleibol": "volleyball" },
            { "el equipo": "team" },
            { "la carrera": "race" },
            { "la pelota": "ball" },
            { "la raqueta": "racket" },
            { "la red": "net" },
            
            // Sports Verbs
            { "jugar": "to play" },
            { "practicar": "to practice" },
            { "ganar": "to win" },
            { "perder": "to lose" },
            { "empatar": "to tie/draw" },
            { "tirar": "to throw" },
            { "patear": "to kick" },
            { "esquiar": "to ski" },
            
            // Days of the Week
            { "El lunes": "Monday" },
            { "el martes": "Tuesday" },
            { "el mi√©rcoles": "Wednesday" },
            { "el jueves": "Thursday" },
            { "el viernes": "Friday" },
            { "el s√°bado": "Saturday" },
            { "el domingo": "Sunday" },
            
            // Months
            { "Enero": "January" },
            { "febrero": "February" },
            { "marzo": "March" },
            { "abril": "April" },
            { "mayo": "May" },
            { "junio": "June" },
            { "julio": "July" },
            { "agosto": "August" },
            { "septiembre": "September" },
            { "octubre": "October" },
            { "noviembre": "November" },
            { "diciembre": "December" },
            
            // Time & Dates
            { "El a√±o": "year" },
            { "el mes": "month" },
            { "la semana": "week" },
            { "el d√≠a": "day" },
            { "la hora": "hour" },
            { "ayer": "yesterday" },
            { "hoy": "today" },
            { "la ma√±ana": "tomorrow/morning" },
            { "pasado ma√±ana": "the day after tomorrow" },
            { "la tarde": "afternoon/evening/late" },
            { "la noche": "night" },
            { "el fin de semana": "weekend" },
            
            // Telling Time
            { "Es la": "It's (for 1 o'clock)" },
            { "Son las": "It's (for other hours)" },
            { "y media": "half past" },
            { "y cuarto": "quarter past" },
            { "menos cuarto": "quarter to" },
            
            // Numbers 0-20
            { "cero": "zero" },
            { "uno": "one" },
            { "dos": "two" },
            { "tres": "three" },
            { "cuatro": "four" },
            { "cinco": "five" },
            { "seis": "six" },
            { "siete": "seven" },
            { "ocho": "eight" },
            { "nueve": "nine" },
            { "diez": "ten" },
            { "once": "eleven" },
            { "doce": "twelve" },
            { "trece": "thirteen" },
            { "catorce": "fourteen" },
            { "quince": "fifteen" },
            { "diecis√©is": "sixteen" },
            { "diecisiete": "seventeen" },
            { "dieciocho": "eighteen" },
            { "diecinueve": "nineteen" },
            { "veinte": "twenty" },
            
            // Tens and Hundreds
            { "treinta": "thirty" },
            { "cuarenta": "forty" },
            { "cincuenta": "fifty" },
            { "sesenta": "sixty" },
            { "setenta": "seventy" },
            { "ochenta": "eighty" },
            { "noventa": "ninety" },
            { "cien": "one hundred" },
            { "ciento": "one hundred (before nouns)" },
            { "doscientos": "two hundred (masculine)" },
            { "doscientas": "two hundred (feminine)" },
            { "quinientos": "five hundred (masculine)" },
            { "quinientas": "five hundred (feminine)" },
            { "mil": "thousand" },
            
            // Colors (as Nouns/Adjectives)
            { "El azul": "blue" },
            { "el rojo": "red" },
            { "el amarillo": "yellow" },
            { "el verde": "green" },
            { "el marr√≥n": "brown" },
            { "el morado": "purple" },
            { "el rosa": "pink" },
            { "el negro": "black" },
            { "el blanco": "white" },
            { "el gris": "gray" },
            { "el naranja": "orange" },
            
            // Key Verbs
            { "Ser": "to be (permanent)" },
            { "estar": "to be (temporary/location)" },
            { "tener": "to have" },
            { "haber": "to have (auxiliary)/there is/are" },
            { "ir": "to go" },
            { "querer": "to want/to love" },
            { "poder": "to be able to/can" },
            { "hacer": "to do/to make" },
            { "decir": "to say/to tell" },
            { "dar": "to give" },
            { "ver": "to see" },
            { "saber": "to know (facts)" },
            { "conocer": "to know (people/places)" },
            { "poner": "to put" },
            { "salir": "to go out/to leave" },
            { "venir": "to come" },
            { "traer": "to bring" },
            { "pensar": "to think" },
            { "sentir": "to feel/to regret" },
            { "gustar": "to like" },
            { "encantar": "to love (things)" },
            { "necesitar": "to need" },
            { "comprar": "to buy" },
            { "costar": "to cost" },
            { "probar": "to try/to taste" },
            { "tocar": "to touch/to play (instrument)" },
            { "cepillarse": "to brush (oneself)" },
            { "ducharse": "to shower (oneself)" },
            
            // Question Words
            { "Qu√©": "what" },
            { "qui√©n": "who" },
            { "cu√°ndo": "when" },
            { "d√≥nde": "where" },
            { "por qu√©": "why" },
            { "c√≥mo": "how" },
            { "cu√°nto": "how much (male)" },
            { "cu√°nta": "how much (female)" },
            { "cu√°ntos": "how many (male)" },
            { "cu√°ntas": "how many (female)" },
            
            // Possessives
            { "Mi": "my" },
            { "tu": "your (informal)" },
            { "su": "his/her/your (formal)/their" },
            { "nuestro": "our (male)" },
            { "nuestra": "our (female)" },
            { "vuestro": "your (plural, Spain, male)" },
            { "vuestra": "your (plural, Spain, female)" },
            { "m√≠o": "mine (male)" },
            { "m√≠a": "mine (female)" },
            { "tuyo": "yours (informal, male)" },
            { "tuya": "yours (informal, female)" },
            { "suyo": "his/hers/yours (formal)/theirs (male)" },
            { "suya": "his/hers/yours (formal)/theirs (female)" },
            
            // Demonstratives
            { "Este": "this (male)" },
            { "esta": "this (female)" },
            { "eso": "that (neuter)" },
            { "esa": "that (female)" },
            { "aquel": "that (over there, male)" },
            { "aquella": "that (over there, female)" },
            
            // Pronouns
            { "Yo": "I" },
            { "t√∫": "you (informal)" },
            { "√©l": "he" },
            { "ella": "she" },
            { "usted": "you (formal)" },
            { "nosotros": "we (male/mixed)" },
            { "nosotras": "we (female)" },
            { "vosotros": "you all (Spain, male/mixed)" },
            { "vosotras": "you all (Spain, female)" },
            { "ellos": "they (male/mixed)" },
            { "ellas": "they (female)" },
            { "ustedes": "you all (formal/Latin America)" },
            
            // Object Pronouns
            { "Me": "me/to me" },
            { "te": "you/to you (informal)" },
            { "se": "himself/herself/yourself/themselves" },
            { "nos": "us/to us" },
            { "os": "you all/to you all (Spain)" },
            { "lo": "him/it (male, direct object)" },
            { "la": "her/it (female, direct object)" },
            { "los": "them (male/mixed, direct object)" },
            { "las": "them (female, direct object)" },
            { "le": "to him/to her/to you (indirect object)" },
            { "les": "to them/to you all (indirect object)" },
            
            // Miscellaneous
            { "El ejercicio": "exercise" },
            { "el viaje": "trip" },
            { "el clima": "climate/weather" },
            { "la direcci√≥n": "address/direction" },
            { "el precio": "price" },
            { "la rebaja": "discount/sale" },
            { "la bolsa": "bag" },
            { "el pasillo": "aisle" },
            { "la caja": "cash register/box" },
            { "el carrito": "shopping cart" },
            { "los productos l√°cteos": "dairy products" },
            { "la cortes√≠a": "courtesy" },
            { "el sue√±o": "sleep/dream" },
            // Transport & Driving
{ "el coche": "car" },
{ "el carro": "car" },
{ "el autom√≥vil": "automobile" },
{ "conducir": "to drive" },
{ "manejar": "to drive (Latin America)" },
{ "el conductor": "driver" },
{ "la conductora": "driver (female)" },
{ "el volante": "steering wheel" },
{ "el freno": "brake" },
{ "el acelerador": "accelerator" },
{ "el claxon": "horn" },
{ "el sem√°foro": "traffic light" },
{ "la se√±al de tr√°fico": "road sign" },
{ "el estacionamiento": "parking lot" },
{ "aparcar": "to park" },
{ "el aparcamiento": "parking" },
{ "la multa": "ticket/fine" },
{ "la gasolina": "gasoline" },
{ "la gasolinera": "gas station" },
{ "el taller mec√°nico": "mechanic shop" },
{ "la llanta": "tire" },
{ "el neum√°tico": "tire" },
{ "el cintur√≥n de seguridad": "seat belt" },
{ "la licencia de conducir": "driver's license" },
{ "la carretera": "highway" },
{ "la autopista": "freeway/motorway" },
{ "la calle": "street" },
{ "la avenida": "avenue" },
{ "el puente": "bridge" },
{ "el t√∫nel": "tunnel" },
{ "el peaje": "toll" },
{ "el atasco": "traffic jam" },
{ "la congesti√≥n": "congestion" },

// Taxis
{ "el taxi": "taxi" },
{ "el taxista": "taxi driver" },
{ "la parada de taxi": "taxi stand" },
{ "el tax√≠metro": "taximeter" },
{ "la tarifa": "fare" },
{ "la propina": "tip" },
{ "¬øPuede llevarme a...?": "Can you take me to...?" },
{ "Al aeropuerto, por favor": "To the airport, please" },
{ "Aqu√≠ mismo": "Right here" },
{ "En la siguiente esquina": "At the next corner" },
{ "¬øCu√°nto es?": "How much is it?" },
{ "¬øAcepta tarjeta?": "Do you accept cards?" },
{ "Solo efectivo": "Cash only" },

// Buses
{ "el autob√∫s": "bus" },
{ "el bus": "bus" },
{ "la guagua": "bus (Caribbean)" },
{ "el cami√≥n": "bus (Mexico)" },
{ "la parada de autob√∫s": "bus stop" },
{ "la estaci√≥n de autobuses": "bus station" },
{ "el conductor de autob√∫s": "bus driver" },
{ "el billete de autob√∫s": "bus ticket" },
{ "el boleto": "ticket" },
{ "el pasaje": "fare/ticket" },
{ "la tarjeta de transporte": "transit card" },
{ "el horario": "schedule/timetable" },
{ "la ruta": "route" },
{ "la l√≠nea de autob√∫s": "bus line" },
{ "¬øEste autob√∫s va a...?": "Does this bus go to...?" },
{ "¬øD√≥nde debo bajarme?": "Where should I get off?" },
{ "La pr√≥xima parada": "Next stop" },
{ "Por favor, pare aqu√≠": "Please stop here" },
{ "Bajar": "to get off" },
{ "Subir": "to get on" },
{ "el asiento": "seat" },
{ "reservado para": "reserved for" },
{ "ceder el asiento": "to give up one's seat" },

// Trains & Rail
{ "el tren": "train" },
{ "la estaci√≥n de tren": "train station" },
{ "el and√©n": "platform" },
{ "la v√≠a": "track" },
{ "el ferrocarril": "railroad" },
{ "el metro": "subway/metro" },
{ "el subterr√°neo": "subway" },
{ "el vag√≥n": "train car" },
{ "el compartimento": "compartment" },
{ "el asiento reservado": "reserved seat" },
{ "el billete de tren": "train ticket" },
{ "el abono": "pass/season ticket" },
{ "la taquilla": "ticket office" },
{ "la m√°quina expendedora": "ticket machine" },
{ "la llegada": "arrival" },
{ "la salida": "departure" },
{ "el retraso": "delay" },
{ "a tiempo": "on time" },
{ "el horario de trenes": "train schedule" },
{ "el expreso": "express train" },
{ "el tren de cercan√≠as": "commuter train" },
{ "el AVE": "high-speed train (Spain)" },
{ "el revisor": "ticket inspector" },
{ "con destino a": "destination" },

// General Transport Terms
{ "el transporte p√∫blico": "public transportation" },
{ "el medio de transporte": "means of transport" },
{ "la direcci√≥n": "direction" },
{ "el mapa": "map" },
{ "la terminal": "terminal" },
{ "la salida": "exit" },
{ "la entrada": "entrance" },
{ "el mostrador de informaci√≥n": "information desk" },
{ "la consigna": "luggage storage" },
{ "la maleta": "suitcase" },
{ "el equipaje": "luggage" },
{ "la mochila": "backpack" },

// Asking for Directions/Help
{ "Estoy perdido": "I'm lost (male)" },
{ "Estoy perdida": "I'm lost (female)" },
{ "¬øC√≥mo llego a...?": "How do I get to...?" },
{ "¬øEst√° lejos?": "Is it far?" },
{ "¬øA qu√© distancia est√°?": "How far is it?" },
{ "¬øCu√°nto tiempo se tarda?": "How long does it take?" },
{ "¬øD√≥nde est√° la parada m√°s cercana?": "Where is the nearest stop?" },
{ "Necesito ayuda": "I need help" },
// Busking & Street Performance
{ "el artista callejero": "street performer" },
{ "el m√∫sico callejero": "street musician" },
{ "el busker": "busker" },
{ "la actuaci√≥n callejera": "street performance" },
{ "la gorra": "hat (for collecting money)" },
{ "la propina voluntaria": "voluntary tip" },
{ "el espect√°culo callejero": "street show" },
{ "el p√∫blico": "audience" },
{ "los espectadores": "spectators" },
{ "aplaudir": "to applaud" },
{ "los aplausos": "applause" },
{ "el permiso": "permit" },
{ "la licencia": "license" },
{ "la acera": "sidewalk" },
{ "la plaza": "square/plaza" },
{ "el centro de la ciudad": "downtown/city center" },
{ "la zona peatonal": "pedestrian zone" },
{ "el escenario improvisado": "improvised stage" },
{ "el micr√≥fono": "microphone" },
{ "el amplificador": "amplifier" },
{ "el altavoz": "speaker" },
{ "la bater√≠a": "drums" },
{ "la guitarra ac√∫stica": "acoustic guitar" },
{ "el viol√≠n": "violin" },
{ "la arm√≥nica": "harmonica" },
{ "el saxof√≥n": "saxophone" },
{ "la flauta": "flute" },
{ "el acorde√≥n": "accordion" },
{ "el xil√≥fono": "xylophone" },
{ "cantar": "to sing" },
{ "tocar un instrumento": "to play an instrument" },
{ "la interpretaci√≥n": "performance" },
{ "el repertorio": "repertoire" },
{ "la canci√≥n popular": "folk song" },
{ "la m√∫sica tradicional": "traditional music" },
{ "el canto callejero": "street singing" },
{ "la hora punta": "rush hour" },
{ "el d√≠a festivo": "holiday" },
{ "el fin de semana": "weekend" },
// Magic Tricks & Illusions
{ "el mago": "magician (male)" },
{ "la maga": "magician (female)" },
{ "el ilusionista": "illusionist" },
{ "el prestidigitador": "sleight-of-hand artist" },
{ "el truco de magia": "magic trick" },
{ "la ilusi√≥n": "illusion" },
{ "el hechizo": "spell" },
{ "la varita m√°gica": "magic wand" },
{ "el sombrero de copa": "top hat" },
{ "la capa": "cape" },
{ "el conejo": "rabbit" },
{ "la paloma": "dove" },
{ "la carta": "card" },
{ "la baraja": "deck of cards" },
{ "el naipe": "playing card" },
{ "la moneda": "coin" },
{ "el billete": "bill/banknote" },
{ "el pa√±uelo": "handkerchief" },
{ "la cuerda": "rope" },
{ "las llaves": "keys" },
{ "el anillo": "ring" },
{ "el reloj": "watch" },
{ "la caja": "box" },
{ "la bola": "ball" },
{ "el cubilete": "cup" },
{ "la desaparici√≥n": "disappearance" },
{ "la aparici√≥n": "appearance" },
{ "la levitaci√≥n": "levitation" },
{ "el escape": "escape" },
{ "la lectura de la mente": "mind reading" },
{ "la predicci√≥n": "prediction" },
{ "la transformaci√≥n": "transformation" },
{ "la transposici√≥n": "transposition" },
{ "¬°Abracadabra!": "Abracadabra!" },
{ "el asombro": "amazement" },
{ "la sorpresa": "surprise" },
{ "el misterio": "mystery" },
{ "la decepci√≥n": "misdirection" },
{ "la destreza manual": "manual dexterity" },
{ "la pr√°ctica": "practice" },
{ "el ensayo": "rehearsal" },
{ "el espect√°culo de magia": "magic show" },
{ "la actuaci√≥n de magia": "magic performance" },
{ "el asistente": "assistant" },
{ "el voluntario": "volunteer" },
{ "la audiencia participativa": "participatory audience" },

// Common Magic Trick Phrases
{ "Mire con atenci√≥n": "Watch carefully" },
{ "No aparte los ojos": "Don't take your eyes off" },
{ "Elija una carta": "Pick a card" },
{ "Memorice su carta": "Memorize your card" },
{ "Sin que yo la vea": "Without me seeing it" },
{ "¬øEs esta su carta?": "Is this your card?" },
{ "¬°Voil√†!": "Voil√†!" },
{ "Aqu√≠ no hay nada": "There's nothing here" },
{ "Ahora usted ver√°": "Now you'll see" },
{ "Con un poco de magia": "With a little magic" },
{ "Prep√°rese para asombrarse": "Prepare to be amazed" },
{ "Lo imposible es posible": "The impossible is possible" },
// Performance & Interaction
{ "Animar al p√∫blico": "to encourage the audience" },
{ "hacer re√≠r": "to make laugh" },
{ "captar la atenci√≥n": "to capture attention" },
{ "interactuar con el p√∫blico": "to interact with the audience" },
{ "la rutina": "routine" },
{ "la actuaci√≥n": "performance" },
{ "el interludio": "interlude" },
{ "el final": "finale/ending" },
{ "la recaudaci√≥n": "collection (of money)" },
{ "las ganancias del d√≠a": "daily earnings" },
{ "tocar para la gente": "to play for people" },
{ "el ambiente": "atmosphere" },
{ "la energ√≠a": "energy" },
{ "el talento": "talent" },
{ "la pasi√≥n": "passion" },
{ "la dedicaci√≥n": "dedication" },
{ "el arte callejero": "street art" },
{ "la cultura urbana": "urban culture" }
        ];

        const fullWordList = rawWordList.map(obj => {
            const key = Object.keys(obj)[0];
            return { es: key, en: obj[key] };
        });

        const grammarBank = [
            // 1. Pronunciation
            { id: 'g_silent_h', type: 'grammar', promptEs: 'Which letter is silent in "hola"?', acceptable: ['h'], topic: 'Pronunciation' },
            { id: 'g_ll_sound', type: 'grammar', promptEs: 'The "ll" in "llamar" sounds like which English letter? (y/j/w)', acceptable: ['y'], topic: 'Pronunciation' },

            // 2. Nouns & Articles
            { id: 'g_art_fem', type: 'grammar', promptEs: 'Definite article for "mesa" (el/la)', acceptable: ['la'], topic: 'Articles' },
            { id: 'g_art_masc', type: 'grammar', promptEs: 'Definite article for "libro" (el/la)', acceptable: ['el'], topic: 'Articles' },
            { id: 'g_art_agua', type: 'grammar', promptEs: 'Definite article for "agua" (el/la)', acceptable: ['el'], topic: 'Articles' },
            { id: 'g_art_mano', type: 'grammar', promptEs: 'Definite article for "mano" (el/la)', acceptable: ['la'], topic: 'Articles' },
            { id: 'g_art_prob', type: 'grammar', promptEs: 'Definite article for "problema" (el/la)', acceptable: ['el'], topic: 'Articles' },
            { id: 'g_plur_vowel', type: 'grammar', promptEs: 'Plural of "casa"', acceptable: ['casas'], topic: 'Pluralization' },
            { id: 'g_plur_cons', type: 'grammar', promptEs: 'Plural of "papel"', acceptable: ['papeles'], topic: 'Pluralization' },

            // 3. Adjectives
            { id: 'g_adj_agree', type: 'grammar', promptEs: 'casas ___ (blanco/blanca/blancos/blancas)', acceptable: ['blancas'], topic: 'Adjectives' },

            // 4. Subject Pronouns
            { id: 'g_pron_we_m', type: 'grammar', promptEs: 'Translate "We" (masculine)', acceptable: ['nosotros'], topic: 'Pronouns' },
            { id: 'g_pron_they_f', type: 'grammar', promptEs: 'Translate "They" (feminine)', acceptable: ['ellas'], topic: 'Pronouns' },

            // 5. Conjugation (Present)
            { id: 'g_pres_ar_yo', type: 'grammar', promptEs: 'Conjugate: hablar (yo)', acceptable: ['hablo'], topic: 'Present Tense' },
            { id: 'g_pres_er_tu', type: 'grammar', promptEs: 'Conjugate: comer (t√∫)', acceptable: ['comes'], topic: 'Present Tense' },
            { id: 'g_pres_ir_nos', type: 'grammar', promptEs: 'Conjugate: vivir (nosotros)', acceptable: ['vivimos'], topic: 'Present Tense' },
            { id: 'g_irr_ser_yo', type: 'grammar', promptEs: 'Conjugate: ser (yo)', acceptable: ['soy'], topic: 'Irregular Verbs' },
            { id: 'g_irr_estar_tu', type: 'grammar', promptEs: 'Conjugate: estar (t√∫)', acceptable: ['est√°s', 'estas'], topic: 'Irregular Verbs' },
            { id: 'g_irr_ir_yo', type: 'grammar', promptEs: 'Conjugate: ir (yo)', acceptable: ['voy'], topic: 'Irregular Verbs' },
            { id: 'g_irr_tener_yo', type: 'grammar', promptEs: 'Conjugate: tener (yo)', acceptable: ['tengo'], topic: 'Irregular Verbs' },

            // 6. Tenses
            { id: 'g_prog_ando', type: 'grammar', promptEs: 'Walking: camin___ (suffix)', acceptable: ['ando'], topic: 'Present Progressive' },
            { id: 'g_fut_voy', type: 'grammar', promptEs: 'I am going to eat: ___ a comer', acceptable: ['voy'], topic: 'Near Future' },

            // 7. Ser vs Estar
            { id: 'g_ser_prof', type: 'grammar', promptEs: '___ m√©dico (Soy/Estoy)', acceptable: ['soy'], topic: 'Ser vs Estar' },
            { id: 'g_est_loc', type: 'grammar', promptEs: '___ en casa (Soy/Estoy)', acceptable: ['estoy'], topic: 'Ser vs Estar' },

            // 8. Question Words
            { id: 'g_qw_who', type: 'grammar', promptEs: 'Translate "Who"', acceptable: ['qui√©n', 'quien'], topic: 'Question Words' },
            { id: 'g_qw_where', type: 'grammar', promptEs: 'Translate "Where"', acceptable: ['d√≥nde', 'donde'], topic: 'Question Words' },

            // 9. Prepositions
            { id: 'g_prep_with', type: 'grammar', promptEs: 'Translate "With"', acceptable: ['con'], topic: 'Prepositions' },
            { id: 'g_prep_without', type: 'grammar', promptEs: 'Translate "Without"', acceptable: ['sin'], topic: 'Prepositions' },

            // 10. Numbers/Time
            { id: 'g_num_100', type: 'grammar', promptEs: 'Number 100', acceptable: ['cien'], topic: 'Numbers' },
            { id: 'g_time_1', type: 'grammar', promptEs: '___ la una (Es/Son)', acceptable: ['es'], topic: 'Time' },
            { id: 'g_time_2', type: 'grammar', promptEs: '___ las dos (Es/Son)', acceptable: ['son'], topic: 'Time' },

            // 11. Possession
            { id: 'g_poss_mi', type: 'grammar', promptEs: '___ casa (My)', acceptable: ['mi'], topic: 'Possession' },
            
            // 12. Demonstratives
            { id: 'g_demo_this', type: 'grammar', promptEs: 'Translate "This" (masculine)', acceptable: ['este'], topic: 'Demonstratives' },

            // 13. Object Pronouns
            { id: 'g_obj_lo', type: 'grammar', promptEs: 'I see him/it: ___ veo', acceptable: ['lo'], topic: 'Object Pronouns' },
            
            // 14. Gustar
            { id: 'g_gust_pl', type: 'grammar', promptEs: 'Me ___ los libros (gusta/gustan)', acceptable: ['gustan'], topic: 'Gustar' },

            // 15. Weather
            { id: 'g_weath_hace', type: 'grammar', promptEs: '___ calor (Hace/Esta)', acceptable: ['hace'], topic: 'Weather' },

            // 16. Phrases
            { id: 'g_phr_name', type: 'grammar', promptEs: 'Me ___ Juan (call/name)', acceptable: ['llamo'], topic: 'Phrases' },
            { id: 'g_polite_plz', type: 'grammar', promptEs: 'Translate "Please"', acceptable: ['por favor'], topic: 'Phrases' },

            // 17. Word Order
            { id: 'g_neg_no', type: 'grammar', promptEs: 'I don\'t have money: ___ tengo dinero', acceptable: ['no'], topic: 'Negation' },

            // 18. Contractions
            { id: 'g_contr_al', type: 'grammar', promptEs: 'a + el = ___', acceptable: ['al'], topic: 'Contractions' },
            { id: 'g_contr_del', type: 'grammar', promptEs: 'de + el = ___', acceptable: ['del'], topic: 'Contractions' },

            // 19. Comparatives
            { id: 'g_comp_que', type: 'grammar', promptEs: 'M√°s ... ___ (than)', acceptable: ['que'], topic: 'Comparatives' }
        ];

        // State
        let quizQueue = [];
        let reinforcedWords = new Set();
        let historyStack = []; // Stores past cards to go back
        let currentCard = null;
        let correctCounts = {};
        let totalItems = 0;
        let itemsDone = 0;
        let isProcessing = false;
        let synonymMap = {}; // Stores English -> [Spanish1, Spanish2...]
        
        // Session Data for Export
        let sessionNewWords = [];
        let sessionReviewWords = [];

        // Elements
        const setupScreen = document.getElementById('setupScreen');
        const quizScreen = document.getElementById('quizScreen');
        const progressInput = document.getElementById('progressInput');
        const questionWordEl = document.getElementById('questionWord');
        const answerInput = document.getElementById('answerInput');
        const statsDisplay = document.getElementById('statsDisplay');
        const progressBar = document.getElementById('progressBar');
        const langIndicator = document.getElementById('langIndicator');
        const backBtn = document.getElementById('backBtn');

        // Logic
        function insertChar(char) {
            const input = document.getElementById('answerInput');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            input.value = text.substring(0, start) + char + text.substring(end);
            input.focus();
            input.selectionStart = input.selectionEnd = start + 1;
        }

        function startQuiz(mode = 'regular') {
            // Reset history
            historyStack = [];
            reinforcedWords = new Set();
            if (backBtn) backBtn.disabled = true;

            // Build Synonym Map (English -> All valid Spanish words)
            synonymMap = {};
            fullWordList.forEach(item => {
                const enVariations = parseAnswers(item.en);
                enVariations.forEach(en => {
                    const key = en.toLowerCase().trim();
                    if (!synonymMap[key]) synonymMap[key] = [];
                    // Avoid duplicates
                    if (!synonymMap[key].includes(item.es)) {
                        synonymMap[key].push(item.es);
                    }
                });
            });

            const learnedCount = parseInt(progressInput.value) || 0;
            
            if (mode === 'random') {
                // RANDOM MODE: Shuffle all words up to learnedCount
                let pool = fullWordList.slice(0, learnedCount);
                if (pool.length === 0) {
                    alert("Please enter a valid number of learned words (at least 1).");
                    return;
                }
                
                // Shuffle
                quizQueue = pool.sort(() => Math.random() - 0.5);
                
                // Mix in grammar randomly
                grammarBank.forEach(gItem => {
                    const pos = Math.floor(Math.random() * (quizQueue.length + 1));
                    quizQueue.splice(pos, 0, gItem);
                });
                
                // Set session words for AI prompt (just take a sample of random words)
                sessionNewWords = [];
                sessionReviewWords = quizQueue
                    .filter(w => w.type !== 'grammar')
                    .slice(0, 50)
                    .map(w => w.es);

            } else {
                // REGULAR MODE: Spaced Repetition Logic
                
                // 1. Identify segments
                const startPrior = Math.max(0, learnedCount - 40);
                const priorWords = fullWordList.slice(startPrior, learnedCount);
                const newWords = fullWordList.slice(learnedCount, learnedCount + 20);

                let randomWords = [];
                if (startPrior > 0) {
                    const pool = fullWordList.slice(0, startPrior);
                    pool.sort(() => Math.random() - 0.5);
                    randomWords = pool.slice(0, 40);
                }

                // Store for AI Prompt (Unique Spanish words)
                sessionNewWords = newWords.map(w => w.es);
                sessionReviewWords = [...new Set([...priorWords, ...randomWords].map(w => w.es))];

                // 2. Build Base Array (Weighted)
                // "The 20 new words are copied twice (so there are three times as many of them)"
                const newWordsTripled = [];
                newWords.forEach(w => {
                    newWordsTripled.push(w, w, w);
                });

                const baseSet = [
                    ...priorWords,
                    ...newWordsTripled,
                    ...randomWords
                ];

                // 3. Replicate 10 times
                let finalArray = [];
                for (let i = 0; i < 10; i++) {
                    finalArray = finalArray.concat(baseSet);
                }

                if (finalArray.length === 0) {
                    alert("Please increase the number of learned words or check the word list.");
                    return;
                }

                // 4. Shuffle Final Queue
                quizQueue = finalArray.sort(() => Math.random() - 0.5);

                // 4b. Mix in Grammar (Easy -> Hard maps to End -> Start of array)
                const segmentSize = Math.floor(quizQueue.length / (grammarBank.length || 1));
                
                grammarBank.forEach((gItem, index) => {
                    const bucketIndex = (grammarBank.length - 1) - index;
                    let pos = (bucketIndex * segmentSize) + Math.floor(Math.random() * segmentSize);
                    pos = Math.max(0, Math.min(pos, quizQueue.length));
                    quizQueue.splice(pos, 0, gItem);
                });

                // 5. Add Intro Phase (New Words x 2)
                const introWords = [];
                introWords.push(...newWords);
                introWords.push(...newWords);
                introWords.reverse(); // Because we pop()

                quizQueue.push(...introWords);
            }

            totalItems = quizQueue.length;
            itemsDone = 0;

            // Reset stats (optional, but good for session tracking)
            // Note: We don't clear global correctCounts, just local session tracking if any.
            
            setupScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            saveProgress();
            nextCard();
        }

        function parseAnswers(text) {
            const answers = new Set();
            
            // Also accept the exact full string (just in case)
            if (text) answers.add(text);
            
            function addVariations(t) {
                if (!t) return;
                answers.add(t);
                
                // Handle parentheses removal
                const noParens = t.replace(/\s*\(.*?\)/g, '').trim();
                if (noParens && noParens !== t) {
                    answers.add(noParens);
                }
            }

            // Split by slash
            const parts = text.split('/');
            parts.forEach(p => addVariations(p.trim()));

            // Contraction expansion
            const currentList = Array.from(answers);
            const replacements = [
                { pattern: /\bwhat's\b/gi, replacement: "what is" },
                { pattern: /\bit's\b/gi, replacement: "it is" },
                { pattern: /\bi'm\b/gi, replacement: "i am" },
                { pattern: /\byou're\b/gi, replacement: "you are" },
                { pattern: /\bthey're\b/gi, replacement: "they are" },
                { pattern: /\bwe're\b/gi, replacement: "we are" },
                { pattern: /\bthat's\b/gi, replacement: "that is" },
                // Reverse mappings (simple checks)
                { pattern: /\bwhat is\b/gi, replacement: "what's" },
                { pattern: /\bit is\b/gi, replacement: "it's" },
                { pattern: /\bi am\b/gi, replacement: "i'm" },
                { pattern: /\byou are\b/gi, replacement: "you're" },
                { pattern: /\bthey are\b/gi, replacement: "they're" },
                { pattern: /\bwe are\b/gi, replacement: "we're" },
                { pattern: /\bthat is\b/gi, replacement: "that's" }
            ];

            currentList.forEach(ans => {
                replacements.forEach(rep => {
                    if (rep.pattern.test(ans)) {
                        // Replace and add (ignoring case in output)
                        answers.add(ans.replace(rep.pattern, rep.replacement));
                    }
                });
            });

            return Array.from(answers);
        }

        function prevCard() {
            if (historyStack.length === 0) return;

            // Push the current card back onto the FRONT of the queue (so it's next again)
            // Wait, if we go back, we want the current card to be "future" again?
            // Yes, if I am on Card B (after A), and I click Back, I go to A. Card B should be next.
            // So we push currentCard back to queue.
            
            // Note: currentCard stores the *processed* state (including mode). 
            // The queue stores raw objects. We should push currentCard.wordObj back.
            if (currentCard && currentCard.wordObj) {
                quizQueue.push(currentCard.wordObj);
                itemsDone--; // Revert progress count
            }

            const previousWordObj = historyStack.pop();
            
            // Update UI state
            if (historyStack.length === 0 && backBtn) backBtn.disabled = true;
            
            // Re-render this card immediately (bypass nextCard's queue popping)
            loadCard(previousWordObj);
            
            // Since we went back, we are re-doing an item.
            // itemsDone was decremented above for the *current* card being cancelled.
            // itemsDone for the *previous* card (which we are now viewing) was already counted when we saw it first?
            // Actually, simplest is: itemsDone tracks how many we COMPLETED. 
            // If we go back to view A, we haven't "completed" A again yet. 
            // So itemsDone should probably decrement.
            itemsDone--; 
            updateProgress();
        }

        function applyReinforcement() {
            if (!currentCard || !currentCard.wordObj) return;

            const wordObj = currentCard.wordObj;
            reinforcedWords.add(wordObj);
            
            // Add 18 copies as requested
            const copiesToAdd = 18;

            for (let i = 0; i < copiesToAdd; i++) {
                // Random position in the queue
                const pos = Math.floor(Math.random() * quizQueue.length);
                quizQueue.splice(pos, 0, wordObj);
            }

            totalItems += copiesToAdd; 
            updateProgress();
        }

        let autoAdvanceTimer = null;

        function loadCard(wordObj) {
            isProcessing = false;
            document.getElementById('overrideBtn').classList.add('hidden');
            
            if (wordObj.type === 'grammar') {
                currentCard = {
                    wordObj: wordObj,
                    mode: 'grammar',
                    question: wordObj.promptEs,
                    answer: wordObj.acceptable[0],
                    acceptable: wordObj.acceptable
                };
                questionWordEl.textContent = currentCard.question;
                langIndicator.textContent = `Grammar: ${wordObj.topic}`;
            } else {
                // Fallback if we only have wordObj:
                const mode = (wordObj._savedMode) ? wordObj._savedMode : (Math.random() < 0.5 ? 'toEN' : 'toES');
                const rawAnswer = mode === 'toEN' ? wordObj.en : wordObj.es;
                
                currentCard = {
                    wordObj: wordObj,
                    mode: mode,
                    question: mode === 'toEN' ? wordObj.es : wordObj.en,
                    answer: rawAnswer,
                    acceptable: parseAnswers(rawAnswer)
                };

                // SMART SYNONYMS
                if (mode === 'toES') {
                     const enQuestions = parseAnswers(wordObj.en);
                     enQuestions.forEach(q => {
                         const key = q.toLowerCase().trim();
                         if (synonymMap[key]) {
                             synonymMap[key].forEach(esSynonym => {
                                 currentCard.acceptable.push(esSynonym);
                             });
                         }
                     });
                }

                questionWordEl.textContent = currentCard.question;
                langIndicator.textContent = mode === 'toEN' ? "Spanish ‚Üí English" : "English ‚Üí Spanish";
            }
            
            answerInput.value = "";
            answerInput.className = "";
            answerInput.focus();
            statsDisplay.textContent = "";
        }

        function nextCard() {
            // Clear any pending timer
            if (autoAdvanceTimer) clearTimeout(autoAdvanceTimer);
            
            document.getElementById('overrideBtn').classList.add('hidden');
            
            // 1. Save current card to history before moving on
            if (currentCard) {
                // We verify it's not null (start of game)
                // We attach the mode used so we can restore it exactly
                const historyItem = currentCard.wordObj;
                historyItem._savedMode = currentCard.mode;
                historyStack.push(historyItem);
                
                if (backBtn) backBtn.disabled = false;
            }

            if (quizQueue.length === 0) {
                alert("Quiz Complete! Great job.");
                location.reload();
                return;
            }

            isProcessing = false;
            const wordObj = quizQueue.pop();
            itemsDone++;
            updateProgress();
            
            loadCard(wordObj);
        }

        function cleanAnswer(text) {
            // 1. Lowercase & Punctuation
            let str = text.toLowerCase().replace(/[.,?!¬°¬ø]/g, '');
            
            // Replace hyphens with spaces
            str = str.replace(/-/g, ' ');
            
            // 2. Remove text in parentheses
            str = str.replace(/\s*\(.*\)/g, ' ');
            
            // 3. Remove specific grammar tags (word boundaries)
            const tags = [
                'male', 'female', 'masc', 'fem', 'masculine', 'feminine', 'femanine',
                'formal', 'informal', 'singular', 'plural', 'pl', 'sg',
                'spain', 'latam', 'latin america'
            ];
            const regex = new RegExp(`\\b(${tags.join('|')})\\b`, 'g');
            let stripped = str.replace(regex, '');
            
            // 4. Collapse whitespace
            stripped = stripped.replace(/\s+/g, ' ').trim();
            
            // Safety: If we stripped everything (e.g. the answer was "Male"), return the basic normalized version
            if (stripped.length === 0) {
                return str.trim(); 
            }
            
            return stripped;
        }
        
        function overrideCorrect() {
            if (isProcessing) return; // Prevent double clicking if already moving on
            
            // Treat as correct
            if (currentCard.wordObj.es) {
                if (!correctCounts[currentCard.wordObj.es] === undefined) correctCounts[currentCard.wordObj.es] = 0;
                correctCounts[currentCard.wordObj.es]++;
                saveProgress();
                statsDisplay.textContent = `Marked Correct! (Manual Override)`;
            } else {
                statsDisplay.textContent = "Marked Correct!";
            }
            
            // Visual feedback
            answerInput.classList.remove('input-incorrect');
            answerInput.classList.add('input-correct');
            statsDisplay.style.color = "var(--success)";
            document.getElementById('overrideBtn').classList.add('hidden');
            
            isProcessing = true;
            autoAdvanceTimer = setTimeout(() => {
                nextCard();
            }, 1000);
        }

        function checkAnswer() {
            if (isProcessing) return;
            if (autoAdvanceTimer) clearTimeout(autoAdvanceTimer);

            const userRaw = answerInput.value;
            const userClean = cleanAnswer(userRaw);
            
            // Check if any acceptable answer matches
            // We compare the "cleaned" user input against the "cleaned" acceptable answer
            const isCorrect = currentCard.acceptable.some(a => {
                return cleanAnswer(a) === userClean;
            });
            
            // isProcessing = true; // Wait to set this until we know if it's correct or we need to wait for override

            if (isCorrect) {
                isProcessing = true;
                // Correct
                answerInput.classList.add('input-correct');
                
                if (currentCard.wordObj.es) {
                    if (!correctCounts[currentCard.wordObj.es]) correctCounts[currentCard.wordObj.es] = 0;
                    correctCounts[currentCard.wordObj.es]++;
                    saveProgress();

                    // Check for 3 correct guesses removal
                    if (correctCounts[currentCard.wordObj.es] >= 3) {
                         const initialLength = quizQueue.length;
                         quizQueue = quizQueue.filter(item => item !== currentCard.wordObj);
                         const removedCount = initialLength - quizQueue.length;
                         totalItems -= removedCount;
                         updateProgress();
                         statsDisplay.textContent = `Correct! Mastered (${correctCounts[currentCard.wordObj.es]} times). Removed from future cards.`;
                    } else {
                        statsDisplay.textContent = `Correct! You've mastered "${currentCard.wordObj.es}" ${correctCounts[currentCard.wordObj.es]} times.`;
                    }
                } else {
                    statsDisplay.textContent = "Correct!";
                }

                autoAdvanceTimer = setTimeout(() => {
                    nextCard();
                }, 1000);

            } else {
                // Incorrect - Show error AND override button
                answerInput.classList.add('input-incorrect');
                statsDisplay.style.color = "var(--error)";
                
                const niceList = currentCard.acceptable
                    .filter(a => a.length < 50) 
                    .join(' OR ');
                    
                statsDisplay.textContent = `Incorrect. Acceptable: ${niceList}`;
                
                // Show override button
                document.getElementById('overrideBtn').classList.remove('hidden');
                
                // Automatic reinforcement
                applyReinforcement();

                // Auto-advance delay logic
                // If the user does nothing, we move on.
                
                isProcessing = true;
                autoAdvanceTimer = setTimeout(() => {
                    nextCard();
                }, 5000);
            }
        }

        function updateProgress() {
            const pct = (itemsDone / totalItems) * 100;
            progressBar.style.width = pct + "%";
        }

        function copyAiPrompt() {
            if (sessionNewWords.length === 0 && sessionReviewWords.length === 0) {
                alert("Start the quiz first to generate a prompt.");
                return;
            }

            const promptText = `I would like you to help me practice Spanish by having a conversation with me using only these Spanish words. Please try to use the newly added words (listed first) more frequently than the rest in order to help me remember them.

NEW WORDS (Prioritize these):
${sessionNewWords.join(', ')}

REVIEW WORDS:
${sessionReviewWords.join(', ')}`;

            navigator.clipboard.writeText(promptText).then(() => {
                const btn = document.querySelector('.btn-outline');
                const originalText = btn.textContent;
                btn.textContent = "‚úÖ Copied to Clipboard!";
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert("Failed to copy to clipboard. Please allow clipboard permissions.");
            });
        }

        function loadProgress() {
            const savedCounts = localStorage.getItem('spanishApp_correctCounts');
            if (savedCounts) {
                try {
                    correctCounts = JSON.parse(savedCounts);
                } catch (e) {
                    console.error("Error parsing saved progress", e);
                }
            }
            const savedLearned = localStorage.getItem('spanishApp_learnedCount');
            if (savedLearned) {
                progressInput.value = savedLearned;
            }
        }

        function saveProgress() {
            localStorage.setItem('spanishApp_correctCounts', JSON.stringify(correctCounts));
            localStorage.setItem('spanishApp_learnedCount', progressInput.value);
        }

        function resetProgress() {
            if (confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                localStorage.removeItem('spanishApp_correctCounts');
                localStorage.removeItem('spanishApp_learnedCount');
                correctCounts = {};
                progressInput.value = "";
                location.reload();
            }
        }

        // Initialize
        loadProgress();

        // Event Listeners
        answerInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

    </script>
</body>
</html>